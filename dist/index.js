var Q=Object.create;var h=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var M=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var _=(s,t)=>{for(var e in t)h(s,e,{get:t[e],enumerable:!0})},F=(s,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of L(t))!S.call(s,r)&&r!==e&&h(s,r,{get:()=>t[r],enumerable:!(o=G(t,r))||o.enumerable});return s};var x=(s,t,e)=>(e=s!=null?Q(M(s)):{},F(t||!s||!s.__esModule?h(e,"default",{value:s,enumerable:!0}):e,s)),A=s=>F(h({},"__esModule",{value:!0}),s);var T={};_(T,{GraphQLClient:()=>y.GraphQLClient,batchRequests:()=>y.batchRequests,createDeleteUpdateFields:()=>j,createNestedInput:()=>B,default:()=>m,excludePropsFomObj:()=>N,generateSort:()=>C,generateWherePropFromFilters:()=>P,gql:()=>y.gql,includeJustPropsFromObj:()=>w,qqlQueryBuilder:()=>H,rawRequest:()=>y.rawRequest,request:()=>y.request,resolveRequestDocument:()=>y.resolveRequestDocument,updateNestedInput:()=>I});module.exports=A(T);var V=require("graphql-request"),c=x(require("gql-query-builder")),g=x(require("pluralize")),p=x(require("camelcase"));var z=(s,t)=>s.map(e=>e==null?void 0:e.id).filter(e=>!!e).indexOf(t==null?void 0:t.id)!==-1,J=s=>{let{id:t,...e}=s;return{data:{...e},where:{id:Number(t)}}},j=(s,t)=>{if(console.log("currentData...",s),console.log("initialData...",t),Array.isArray(s)){let e=s.filter(a=>!(a!=null&&a.id)),o=s.filter(a=>!!(a!=null&&a.id)).map(J),r=(t||[]).filter(a=>!z(s,a));return{create:e,update:o,delete:r}}return console.log("currentData .....",s),Object.keys(s).length===1&&(s!=null&&s.id)?{connect:{id:Number(s==null?void 0:s.id)}}:{}},I=(s,t={})=>Object.entries(s).reduce((e,[o,r])=>({...e,[o]:{...j(r,null)}}),{}),w=(s,t)=>Object.entries(s).filter(([e,o])=>t.indexOf(e)!==-1).reduce((e,[o,r])=>({...e,[o]:r}),{}),N=(s,t)=>Object.entries(s).filter(([e,o])=>t.indexOf(e)===-1).reduce((e,[o,r])=>({...e,[o]:r}),{}),B=s=>Object.entries(s).reduce((t,[e,o])=>({...t,[e]:{create:o}}),{}),C=(s=[])=>s.map(e=>e!=null&&e.field&&(e!=null&&e.order)?{[e==null?void 0:e.field]:e==null?void 0:e.order}:null).filter(e=>!!e),P=(s=[],t=[],e=[])=>(console.log("props from filters....",s),s.reduce((r,a)=>{if(a.operator!=="or"&&a.operator!=="and"&&"field"in a){let{field:n,operator:u,value:i}=a;if(console.log(u,i,"nestedFieldsNames",t),u==="in"&&e.indexOf(n)!==-1)return{...r,[n]:{some:{id:{in:i.map(l=>Number(l))}}}};if(u==="in"&&t.indexOf(n)!==-1)return{...r,[n]:{is:{id:{in:i.map(l=>Number(l))}}}};if(u==="eq"&&e.indexOf(n)!==-1)return{...r,[n]:{some:{id:{equals:Number(i)}}}};if(u==="eq"&&t.indexOf(n)!==-1)return{...r,[n]:{is:{id:{equals:Number(i)}}}};if(u==="eq"&&t.indexOf(n)===-1&&e.indexOf(n)!==-1)return{...r,[n]:{equals:i}};if(["lt","gt","lte","gte"].indexOf(u)!==-1)return{...r,[n]:{[u]:i}}}return{...r}},{}));var k=s=>({getList:async t=>{let{resource:e,pagination:o,sorters:r,filters:a,meta:n}=t,u=g.default.singular(e),{current:i,pageSize:l,mode:d="server"}=o??{},q=C(r),b=(n==null?void 0:n.where)||P(a,n==null?void 0:n.nestedFieldsNames,n==null?void 0:n.nestedListFieldsNames),f=(0,p.default)(u,{pascalCase:!0}),R=(0,g.default)(f),v=`all${R}`,O=`_all${R}Meta`,{query:U,variables:W}=c.query([{operation:v,variables:{where:{value:b,type:`${f}WhereInput`},orderBy:{value:q,type:`[${f}OrderByWithRelationInput!]`},page:{value:Number(i||1),required:!1,type:"Float"},perPage:{value:Number(l||10),required:!1,type:"Float"}},fields:(n==null?void 0:n.fields)||[]},{operation:O,variables:{where:{value:b,type:`${f}WhereInput`}},fields:["count"]}]),$=await s.request(U,W);return{data:$[v],total:Number($[O].count)}},getMany:async({resource:t,ids:e,meta:o})=>{let r=g.default.singular(t),n=`all${(0,p.default)(r,{pascalCase:!0})}`,{query:u,variables:i}=c.query({operation:n,variables:{where:{value:{id_in:e}}},fields:o==null?void 0:o.fields});return{data:(await s.request(u,i))[n]}},create:async({resource:t,variables:e,meta:o})=>{let r=g.default.singular(t),a=(0,p.default)(r,{pascalCase:!0}),n=(0,p.default)(`create${a}`),u=(o==null?void 0:o.operation)??n,i=(o==null?void 0:o.nestedFieldsNames)||[],l=w(e,i),d=B(l),q=N(e,i),{query:b,variables:f}=c.mutation({operation:u,variables:{createInput:{value:{...q,...d},type:`${a}CreateInput!`}},fields:o==null?void 0:o.fields});return{data:(await s.request(b,f))[u][r]}},createMany:async({resource:t,variables:e,meta:o})=>{let r=g.default.singular(t),a=(0,p.default)(r,{pascalCase:!0}),n=(0,p.default)(`create${a}`),u=(o==null?void 0:o.operation)??n;return{data:await Promise.all(e.map(async l=>{let{query:d,variables:q}=c.mutation({operation:u,variables:{createInput:{value:{data:l},type:`${a}CreateInput`}},fields:["id"]});return(await s.request(d,q))[u][r]}))}},update:async({resource:t,id:e,variables:o,meta:r})=>{let a=g.default.singular(t),n=(0,p.default)(a,{pascalCase:!0}),u=(0,p.default)(`update${n}`),i=(r==null?void 0:r.operation)??u,l={},d=(r==null?void 0:r.nestedFieldsNames)||[],q=w(o,d),b=I(q,l),f=N(o,d),{query:R,variables:v}=c.mutation({operation:i,variables:{id:{value:Number(e),type:"Int!"},updateInput:{value:{...f,...b},type:`${n}UpdateInput!`}},fields:["id"]});return{data:(await s.request(R,v))[i][a]}},updateMany:async({resource:t,ids:e,variables:o,meta:r})=>{let a=g.default.singular(t),n=(0,p.default)(a,{pascalCase:!0}),u=(0,p.default)(`update${n}`),i=(r==null?void 0:r.operation)??u;return{data:await Promise.all(e.map(async d=>{let{query:q,variables:b}=c.mutation({operation:i,variables:{id:{value:Number(d),type:"Int!"},updateInput:{value:{...o},type:`${n}UpdateInput!`}},fields:["id"]});return(await s.request(q,b))[i][a]}))}},getOne:async({resource:t,id:e,meta:o})=>{let r=g.default.singular(t),n=(0,p.default)(r,{pascalCase:!0}),{query:u,variables:i}=c.query({operation:n,variables:{id:{value:Number(e),type:"Int!"}},fields:(o==null?void 0:o.fields)||["id"]});return{data:(await s.request(u,i))[n]}},deleteOne:async({resource:t,id:e,meta:o})=>{let r=g.default.singular(t),a=(0,p.default)(r,{pascalCase:!0}),n=(0,p.default)(`delete${a}`),u=(o==null?void 0:o.operation)??n,{query:i,variables:l}=c.mutation({operation:u,variables:{id:{value:Number(e),type:"Int!"}},fields:["id"]});return{data:(await s.request(i,l))[u][r]}},deleteMany:async({resource:t,ids:e,meta:o})=>{let r=g.default.singular(t),a=(0,p.default)(r,{pascalCase:!0}),n=(0,p.default)(`delete${a}`),u=(o==null?void 0:o.operation)??n;return{data:await Promise.all(e.map(async l=>{let{query:d,variables:q}=c.mutation({operation:u,variables:{id:{value:Number(l),type:"Int!"}},fields:["id"]});return(await s.request(d,q))[u][r]}))}},getApiUrl:()=>{throw Error("Not implemented on refine-graphql data provider.")},custom:async({url:t,method:e,headers:o,meta:r})=>{let a=s;if(t&&(a=new V.GraphQLClient(t,{headers:o})),r)if(r.operation)if(e==="get"){let{query:n,variables:u}=c.query({operation:r.operation,fields:r.fields,variables:r.variables});return{data:(await a.request(n,u))[r.operation]}}else{let{query:n,variables:u}=c.mutation({operation:r.operation,fields:r.fields,variables:r.variables});return{data:(await a.request(n,u))[r.operation]}}else throw Error("GraphQL operation name required.");else throw Error("GraphQL need to operation, fields and variables values in meta object.")}}),E=k;var y=require("graphql-request"),H=x(require("gql-query-builder")),m=E;
//# sourceMappingURL=index.js.map